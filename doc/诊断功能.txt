
诊断功能主要是对各种异常情况进行记录

异常情况包括：
1、诊断信息标志错误、校验错误
2、看门狗重启、连续看门狗重启
3、FLASH存储数据失败

一、存储数据定义

诊断数据（64B）：
①有效数据（56B）：数据格式均为u16（2B），特殊标注除外
②预留（2B）：预留
③校验（2B）：有效数据按字节加和后取反
④标志（4B）：预定的u32固定值

有效数据：
1、诊断信息标志错误、校验错误（8B）
标志错误：诊断数据区没有正确的标志，将该计数+1，并将其余部分格式化
校验错误：诊断数据区校验错误，将该计数+1，并重新计算校验
预留：4B

2、看门狗重启、连续看门狗重启（8B）
看门狗重启：当且仅当本次为看门狗重启时，该计数+1
连续看门狗重启：当且仅当本次和上次均为看门狗重启时，该计数+1
预留：4B

3、FLASH存储数据失败（38B）
键盘配置数据错误计数*8
灯效配置数据错误计数*8
全局配置数据错误计数*1
预留：4B

4、最后错误位置（2B）
最后错误位置*1B
预留：1B

二、其他接口
诊断功能从PCON寄存器获取本次复位原因
诊断功能接管RESET_KEEP寄存器，用来记录复位前的状态
RESET_KEEP：
bit3：上次复位是否为看门狗复位
bit2~bit0：连续复位计数

三、调用逻辑
1、初始化
先检查诊断标志
再检查复位原因
最后检查诊断校验

2、数据存储
数据存储后，校验完整性，若出错，则使得该处对应计数+1
为防止递归，这里不检查诊断数据本身存储是否出错




























